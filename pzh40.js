var phone_num="12341234",name="P Wong",email="abc@company.com",r=18e5,s=300,t="https://coupon.pizzahut.com.hk/api",u="4200",v=null,w=null;function x(){var e=t+"/Home/ActivityList";$data={a:"",b:u},N("Getting activity list: "+JSON.stringify($data)),$.c({url:e+"?r="+Math.random(),type:"post",data:$data,d:"json",cache:!1,timeout:r,e:function(t){N("Responsed: "+JSON.stringify(t));for(var e=t.f,a=!1,n=0;n<e.length&&!a;n++){var i=e[n];null!=i.activity_name_en.match(/40 quotas/)&&(a=!0,N("activity_idx: "+(v=i.g)),null!=v&&""!=v?y():(N("No activity ID, retry in "+s+"ms"),setTimeout(x,s)))}},error:function(t){N("Failed: "+t.status),x()}})}function y(){var e=t+"/Home/CouponList";$data={a:"",lang:"zh",g:v},N("Getting coupon list: "+JSON.stringify($data)),$.c({url:e+"?r="+Math.random(),type:"post",data:$data,d:"json",cache:!1,timeout:r,e:function(t){N("Responsed: "+JSON.stringify(t));for(var e=t.f,a=!1,n=0;n<e.length&&!a;n++){var i=e[n];null!=i.name_en.match(/Super Supreme Large Pizza/)&&(a=!0,w=i.h,N("activity_idx: "+v),N("redeemedQuantity: "+(i=i.i)),i<40&&z())}},error:function(t){N("Failed: "+t.status),y()}})}function z(){var e=t+"/User/SendSms";$data={j:w,phone:phone_num},N("Sending SMS: "+JSON.stringify($data)),$.c({url:e+"?r="+Math.random(),type:"post",data:$data,d:"json",cache:!1,timeout:r,e:function(t){N("Responsed: "+JSON.stringify(t)),"1"==t.code?A():(t.code="10001",N("SMS too frequent, retry in 10s"),setTimeout(z,1e4))},error:function(t){N("Failed: "+t.status),z()}})}function A(){var t,e=G(),a=J();null!=e&&null!=a?B(e,a):(t="",null==e&&(t+="[SMS validate code]"),null==a&&(t+="[Recaptcha]"),N("Waiting for "+t),setTimeout(A,s))}function B(e,a){var n=t+"/User/Register";$data={b:u,j:w,name:name,phone:phone_num,email:email,k:e,language:"zh",g:v,a:a},N("Registering: "+JSON.stringify($data)),$.c({url:n+"?r="+Math.random(),type:"post",data:$data,d:"json",cache:!1,timeout:r,e:function(e){var a,n;N("Responsed: "+JSON.stringify(e)),"1"==e.code?(N("Success."),a=e.f.l,n=e.f.m,N("S/N: "+a),N("Coupon: "+t+"/t/a/"+n)):"10002"==e.code&&N("Out of stock"),N("End")},error:function(t){N("Failed: "+t.status),B(e,a)}})}function C(){0==$("input#sms_validate_code").length&&(N("Appending SMS input field"),$("div.activity-bar").append('<form onsubmit="updateValidateCode(); return false;"><input type="text" id="sms_validate_code" size="6" maxlength="4" placeholder="SMS Code" style="font-size:40px;border-bottom:2px black solid !important;"><input type="button" value="Update SMS Code" style="padding: 5px; border: 2px black solid !important" onclick="updateValidateCode()"></form>'))}function D(){$("<script>").o("src","https://www.google.com/recaptcha/api.js").n("body"),$("div.activity-bar").append('<div class="g-recaptcha" data-sitekey="6LfHhR4cAAAAAJfA-yCaorJIkWIemMUOQuDGd83q" data-callback="updateRecaptcha" data-expired-callback="removeRecaptcha"></div>')}function E(t){t=document.cookie.match("(^|;) ?"+t+"=([^;]*)(;|$)");return t?t[2]:null}function F(t,e,a){var n=new Date;n.setTime(n.getTime()+60*a*1e3),document.cookie=t+"="+e+";expires="+n.toUTCString()}function G(){return E("sms_validate_code")}function H(){var t=$("input#sms_validate_code").p();""==t?I():(F("sms_validate_code",t,1),N("Updating validate code in cookies: "+t))}function I(){F("sms_validate_code","",-1),N("Removed validate code from cookies")}function J(){return E("gres")}function K(){F("gres",grecaptcha.q(),1),N("Updating recaptcha response: "+grecaptcha.q())}function L(){F("gres","",-1),N("Recaptcha expired")}function M(t){var e=t=>("0"+t).slice(-2),a=(n=t.getTimezoneOffset())<0?"+":"-",n=Math.abs(n);return t.getFullYear()+"-"+e(t.getMonth()+1)+"-"+e(t.getDate())+"T"+e(t.getHours())+":"+e(t.getMinutes())+":"+e(t.getSeconds())+"."+("00"+t.getMilliseconds()).slice(-3)+a+e(n/60|0)+":"+e(n%60)}function N(t){console.log("["+M(new Date)+"] "+t)}C(),D(),I(),L(),x();
